<html>
  <head>
    <script>
      const APPNAME = "katai5plate/easy-notepad";
      let TITLE;
      const intervalTime = 1000;
      let diff = "", saved = false;
      let updatedDate = new Date();
      const savedTime = () => updatedDate.toString().match(/\d{2}:\d{2}:\d{2}/)[0];
      const titleLabel = () => `${saved ? "ðŸ’¾" : ""}${TITLE ? TITLE : savedTime()}`;
      
      const UpdateTitle = nextSaved => {
        if(nextSaved) updatedDate = new Date();
        saved = nextSaved;
        document.title = titleLabel();
      };
      const editorOnChange = () => {
        const now = document.body.innerHTML;
        if(diff !== now){
          console.log("changed!");
          if(!localStorage[APPNAME]) localStorage[APPNAME] = {};
          localStorage[APPNAME].note = document.body.innerHTML;
          UpdateTitle(true);
          diff = now;
        }else{
          if(saved){
            UpdateTitle(false);
            document.title = titleLabel();
          }
        }
      };
      const bodyOnLoad = () => {
        console.log("init!");
        if(!!localStorage[APPNAME]){
          document.body.innerHTML = localStorage[APPNAME].note;
          console.log("loaded!");
        }
      };
      setInterval(editorOnChange, intervalTime);
    </script>
  </head>
  <body contenteditable onload="bodyOnLoad()"></body>
</html>
